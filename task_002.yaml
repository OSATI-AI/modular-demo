task_id: "task_multiple_choice"
template_id: "template_multiple_choice"
title: "Multiple Choice Question"
description: "Select the correct answer."
events:
  send: ["evaluationResult"]
  receive: ["evaluate"]
script: |
  const questionText = "What is the capital of France?";
  const choices = [
    { text: "Berlin", value: "Berlin" },
    { text: "Madrid", value: "Madrid" },
    { text: "Paris", value: "Paris" },
    { text: "Rome", value: "Rome" }
  ];
  const correctAnswerId = 2; // Index of the correct answer

  const { questionElement, choiceElements } = playerApi.callTemplateScript('createLayout', {
    choices: choices.length,
    choicesData: choices
  });

  questionElement.innerText = questionText;

  choices.forEach((choice, index) => {
    choiceElements[index].innerText = choice.text;
    choiceElements[index].dataset.choice = choice.value;
  });

  playerApi.receiveEvent('evaluate', function() {
    const selectedChoiceElement = document.querySelector('.choice.selected');
    if (!selectedChoiceElement) {
      playerApi.sendEvent('evaluationResult', { result: 'No choice selected' });
      return;
    }
    const selectedId = Array.from(choiceElements).indexOf(selectedChoiceElement);
    const isCorrect = selectedId === correctAnswerId;
    playerApi.sendEvent('evaluationResult', {
      selectedId,
      selectedContent: selectedChoiceElement.innerText,
      isCorrect
    });
  });
