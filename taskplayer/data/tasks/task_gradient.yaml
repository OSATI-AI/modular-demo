task_id: "task_gradient"
template_id: "template_figure_question_answer"
title:
  english: "Linear Function Gradient Task"
  german: "Steigung der linearen Funktion"
description: 
  english: "This task requires the user to determine the gradient of a linear function. The user will see a graph of the function and an input field to enter the gradient. The student only sees the graph and does not know the function. He should determine the gradient just by looking at the graph"
  german: "Diese Aufgabe erfordert, dass der Benutzer die Steigung einer linearen Funktion bestimmt. Der Benutzer sieht einen Graphen der Funktion und ein Eingabefeld, um die Steigung einzugeben. Der Sch√ºler sieht nur den Graphen und kennt die Funktion nicht. Er soll die Steigung allein durch Betrachten des Graphen bestimmen"
topic_id: 23
events:
  send: ["evaluationResult", "task_details", "task_loaded"]
  receive: ["evaluate", "refresh", "get_task_details"]
external_scripts:
  - "figure.js"
text:
  text_question:
    english: "What is the gradient of the linear function shown in the figure?"
    german: "Was ist die Steigung der Funktion in der Abbildung?"
  text_answer:
    english: "Gradient"
    german: "Steigung"
script: |
  let gradient;
  const { questionElement, imagePlaceholder, answerElement } = playerApi.callTemplateScript('createLayout', {});

  function generateExercise() {
    do {
      gradient = Math.floor(Math.random() * 11) - 5;
    } while (gradient === 0);
    questionElement.innerText = "{{text.text_question}}";

    // Define the linear function based on the gradient
    function linearFunction(x) {
      return gradient * x;
    }

    plot_graph("image_placeholder", linearFunction, [-10, 10], [-10, 10]);
    playerApi.sendEvent('task_loaded', {});

    const answerInput = document.createElement("input");
    answerInput.className = 'input input-bordered w-full max-w-xs';
    answerInput.id = "answerField";
    const answerSpan = document.createElement("span");
    const answerLabel = document.createElement("p");
    answerLabel.innerHTML = "<b>{{text.text_answer}}: </b>";
    answerSpan.append(answerLabel);
    answerSpan.append(answerInput);
    answerElement.append(answerSpan);

    return { gradient };
  }

  function init() {
    playerApi.receiveEvent('evaluate', function() {
      const userInput = parseInt(document.getElementById('answerField').value, 10);
      const isCorrect = userInput === gradient;
      playerApi.sendEvent('evaluationResult', { userInput, result: gradient, isCorrect });
    });

    playerApi.receiveEvent('refresh', function() {
      imagePlaceholder.innerHTML = '';
      answerElement.innerHTML = '';
      generateExercise();
    });

    playerApi.receiveEvent('get_task_details', function() {
      const taskDetails = playerApi.getTaskDetails();
      const dynamicDetails = `Current exercise: The figure shows a red line which is the graph of the function y=${gradient}x. Therefore the correct solution is ${gradient}.`;
      playerApi.sendEvent('task_details', {
        staticInfo: taskDetails.description,
        dynamicDetails: dynamicDetails
      });
    });
  }

  init();
  generateExercise();
